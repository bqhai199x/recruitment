@page "/register"
@inject HttpClient _http

<h3>Register</h3>

<p>@Message</p>
<p><a href="/login">@Login</a></p>

<EditForm Model="Reg" OnValidSubmit="OnValid" style="max-width:500px;">
	<DataAnnotationsValidator />
	<ValidationSummary />
	<div class="mb-2">
		<InputText class="form-control" @bind-Value="Reg.Email" placeholder="Enter Email"></InputText>
	</div>
	<div class="mb-2">
		<InputText type="password" class="form-control" @bind-Value="Reg.Password" placeholder="Enter Password"></InputText>
	</div>
	<div class="mb-2">
		<InputText type="password" class="form-control" @bind-Value="Reg.Confirmpwd" placeholder="Confirm Password"></InputText>
	</div>
	<div class="mb-2 text-right">
		<button class="btn btn-secondary" disabled="@IsDisabled">register</button>
	</div>
</EditForm>

@code {
	private RegModel Reg { get; set; } = new();

	private string Message { get; set; } = string.Empty;

	private string Login { get; set; } = string.Empty;

	private bool IsDisabled { get; set; } = false;

	private async Task OnValid()
	{
		IsDisabled = true;
		using (var msg = await _http.PostAsJsonAsync<RegModel>("/api/auth/register", Reg, System.Threading.CancellationToken.None))
		{
			if (msg.IsSuccessStatusCode)
			{
				LoginResult result = await msg.Content.ReadFromJsonAsync<LoginResult>();
				Message = result.Message;
				if (result.Success)
				{
					Message += " Please LOGIN to continue.";
					Login = "Click here to LOGIN.";
				}
				else
					IsDisabled = false;
			}
		}
	}
}